# Fairness Testing Experiments

This folder is for executing fairness testing algorithms (RSUTT, AFT, THEMIS) and saving the detected discriminatory data and diversity measurement results.

## Structure

- `RSUTT/`: Contains the script to run the RSUTT algorithm.
- `AFT_Themis/`: Contains the scripts to run AFT and THEMIS.
- `distance_results/`: The directory to store the detected discriminatory data and its diversity results for each fairness testing algorithm (RSUTT, AFT, THEMIS).

## How to Run

### RSUTT
- Execute `RSUTT/RSUTT.py` using:

```
python RSUTT.py RSUTT CENSUS_age SVM 30
```
Arguments:
- Algorithm name (RSUTT)
- Dataset and protected attribute (e.g., CENSUS_age)
- Model (e.g., SVM)
- Number of executions (e.g., 30)

The results will be stored under `distance_results/RSUTT/`.

The 18 tasks are combinations of:

- **Datasets and protected attributes**:
  - `CENSUS_age`
  - `CENSUS_race`
  - `CENSUS_sex`
  - `BANK_age`
  - `GERMAN_age`
  - `GERMAN_sex`

- **Models**:
  - `SVM`
  - `MLPC`
  - `RF`

Each combination of dataset/protected attribute and model is tested, leading to 6 × 3 = 18 tasks.

- You can run all 18 tasks automatically using `RSUTT/run_all_rsutt.py`.  
This script executes all tasks 30 times each.  
The corresponding results are stored in `all_results/RQ2/rsutt/`.

**Notes on RSUTT Parameter Setting:**  
RSUTT includes a hyperparameter \(N\) that controls the number of global search iterations.  To ensure that the number of detected IDIs exceeds the size of the training dataset for every task, we automatically configure \(N\) based on the dataset, protected attribute, and model. The assigned values of \(N\) for each of the 18 scenarios are as follows:

| Dataset-Attribute | Model | N |
|:-------------------|:------|:--|
| CENSUS_age         | SVM   | 1000 |
| CENSUS_age         | MLPC  | 1000 |
| CENSUS_age         | RF    | 1000 |
| CENSUS_race        | SVM   | 10000 |
| CENSUS_race        | MLPC  | 10000 |
| CENSUS_race        | RF    | 1000 |
| CENSUS_sex         | SVM   | 100000 |
| CENSUS_sex         | MLPC  | 10000 |
| CENSUS_sex         | RF    | 1000 |
| BANK_age           | SVM   | 10000 |
| BANK_age           | MLPC  | 10000 |
| BANK_age           | RF    | 1000 |
| GERMAN_age         | SVM   | 1000 |
| GERMAN_age         | MLPC  | 1000 |
| GERMAN_age         | RF    | 1000 |
| GERMAN_sex         | SVM   | 10000 |
| GERMAN_sex         | MLPC  | 1000 |
| GERMAN_sex         | RF    | 1000 |

---

### AFT and THEMIS

Since AFT and THEMIS require **Python 3.8.10**, you need to set up a virtual environment.
Please make sure you are inside the AFT_Themis/ directory before executing the following commands:

```
python3.8 -m venv venv_aft
./venv_aft/Scripts/activate
pip install -r requirements.txt
```
(`AFT_Themis/requirements.txt`)

- **AFT** can be run by:

```
python exp.py --method aft --dataset_name Adult --protected_attr age --model_name SVM --repeat 30 --runtime 3600
```
The results will be saved under `distance_results/AFT/`.

- **THEMIS** can be run by:

```
python exp.py --method themis --dataset_name Adult --protected_attr age --model_name SVM --repeat 30 --runtime 3600
```
The results will be saved under `distance_results/Themis/`.

The tasks for AFT and THEMIS use the following combinations:

- **Datasets and protected attributes**:
  - `Adult age`
  - `Adult race`
  - `Adult sex`
  - `Bank age`
  - `Credit age`
  - `Credit sex`

- **Models**:
  - `SVM`
  - `MLP`
  - `RanForest`

Each dataset/protected attribute and model combination is tested, similar to RSUTT.

Both `run_all_aft.py` and `run_all_themis.py` execute all tasks by passing `--repeat 30` and the default `--runtime 3600` to each execution.  
Thus, each task is repeated 30 times with a maximum runtime of 3600 seconds per execution.  
The results generated by these scripts are stored under the following directories in the main folder:

- `all_results/RQ2/aft/` (for AFT results)
- `all_results/RQ2/themis/` (for THEMIS results)



**Note:**  
Dataset names and model names used in AFT and THEMIS are slightly different from those in RSUTT (e.g., Adult ↔︎ CENSUS, Credit ↔︎ GERMAN, RanForest ↔︎ RF), so be careful when runnnig codes and checking the results.
